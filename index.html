<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Medicamentos - GlobalMed</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .logo-container {
            width: 400px;
            height: 140px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-container svg {
            max-width: 100%;
            max-height: 100%;
        }

        .welcome-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .form-container {
            max-width: 500px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #2196F3;
        }

        .form-control {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
        }

        .btn-primary {
            background: linear-gradient(45deg, #2196F3, #00BCD4);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(33, 150, 243, 0.3);
        }

        .catalog-section {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .search-bar {
            margin-bottom: 30px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
        }

        .search-bar i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #2196F3;
        }

        .products-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .product-card {
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .product-card:hover {
            border-color: #2196F3;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .product-card.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .product-info h3 {
            color: #2196F3;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .product-details {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .product-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            accent-color: #4CAF50;
        }

        .quantity-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            text-align: center;
        }

        .selected-products {
            background: #e8f5e8;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .btn-quote {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }

        .btn-quote:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }

        .persuasive-message {
            background: linear-gradient(45deg, #FF6B6B, #FF8E8E);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .persuasive-message h2 {
            margin-bottom: 15px;
            font-size: 24px;
        }

        .persuasive-message p {
            font-size: 16px;
            line-height: 1.6;
        }

        .back-btn {
            background: #666;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            background: #555;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .welcome-section,
            .catalog-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-container">
                <svg width="480" height="160" viewBox="0 0 480 160" xmlns="http://www.w3.org/2000/svg">
                    <!-- Cruz médica con esquinas redondeadas -->
                    <g>
                        <!-- Parte horizontal de la cruz -->
                        <rect x="24" y="48" width="72" height="24" rx="12" ry="12" fill="#00A7A7"/>
                        <!-- Parte vertical de la cruz -->
                        <rect x="48" y="24" width="24" height="72" rx="12" ry="12" fill="#00A7A7"/>
                        
                        <!-- Globo terráqueo -->
                        <circle cx="60" cy="60" r="20" fill="none" stroke="white" stroke-width="2.5"/>
                        <!-- Líneas del globo -->
                        <ellipse cx="60" cy="60" rx="20" ry="10" fill="none" stroke="white" stroke-width="1.5"/>
                        <ellipse cx="60" cy="60" rx="10" ry="20" fill="none" stroke="white" stroke-width="1.5"/>
                        <line x1="40" y1="60" x2="80" y2="60" stroke="white" stroke-width="1.5"/>
                        
                        <!-- Líneas adicionales del globo -->
                        <ellipse cx="60" cy="60" rx="20" ry="5" fill="none" stroke="white" stroke-width="1"/>
                        <ellipse cx="60" cy="60" rx="5" ry="20" fill="none" stroke="white" stroke-width="1"/>
                    </g>
                    
                    <!-- Texto Global -->
                    <text x="130" y="65" font-family="Arial, sans-serif" font-size="48" font-weight="700" fill="#23394A">Global</text>
                    
                    <!-- Texto MediTH -->
                    <text x="130" y="105" font-family="Arial, sans-serif" font-size="48" font-weight="700" fill="#23394A">MediTH</text>
                    
                    <!-- Texto descriptivo -->
                    <text x="130" y="130" font-family="Arial, sans-serif" font-size="14" font-weight="600" fill="#00A7A7" letter-spacing="1px">DISTRIBUCIÓN CONFIABLE</text>
                    <text x="130" y="148" font-family="Arial, sans-serif" font-size="14" font-weight="600" fill="#00A7A7" letter-spacing="1px">SALUD GARANTIZADA</text>
                </svg>
            </div>
            <h1 style="color: #23394A; margin-bottom: 10px; font-size: 28px;">
                <i class="fas fa-heartbeat" style="color: #00A7A7;"></i> GlobalMediTH
            </h1>
            <p style="color: #00A7A7; font-weight: 600;">Distribución Confiable - Salud Garantizada</p>
        </div>

        <!-- Sección de Bienvenida y Registro -->
        <div class="welcome-section" id="welcomeSection">
            <div class="persuasive-message">
                <h2><i class="fas fa-star"></i> ¡Accede a Más de 3,000 Medicamentos!</h2>
                <p>Encuentra todos los medicamentos que necesitas con la mejor calidad y precios competitivos. Regístrate ahora y accede a nuestro catálogo completo para solicitar tu cotización personalizada.</p>
            </div>

            <div class="form-container">
                <h2 style="text-align: center; color: #2196F3; margin-bottom: 30px;">
                    <i class="fas fa-user-plus"></i> Registro de Cliente
                </h2>
                
                <form id="registrationForm">
                    <div class="form-group">
                        <i class="fas fa-user"></i>
                        <input type="text" class="form-control" id="fullName" placeholder="Nombre Completo" required>
                    </div>
                    
                    <div class="form-group">
                        <i class="fas fa-phone"></i>
                        <input type="tel" class="form-control" id="phone" placeholder="Número de Celular" required>
                    </div>
                    
                    <div class="form-group">
                        <i class="fas fa-map-marker-alt"></i>
                        <input type="text" class="form-control" id="city" placeholder="Ciudad" required>
                    </div>
                    
                    <div class="form-group">
                        <i class="fas fa-envelope"></i>
                        <input type="email" class="form-control" id="email" placeholder="Correo Electrónico" required>
                    </div>
                    
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-arrow-right"></i> Continuar al Catálogo
                    </button>
                </form>
            </div>
        </div>

        <!-- Sección del Catálogo -->
        <div class="catalog-section" id="catalogSection">
            <button class="back-btn" onclick="showWelcome()">
                <i class="fas fa-arrow-left"></i> Volver al Registro
            </button>
            
            <h2 style="text-align: center; color: #2196F3; margin-bottom: 30px;">
                <i class="fas fa-pills"></i> Catálogo de Medicamentos
            </h2>

            <!-- Barra de Búsqueda -->
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" id="searchInput" placeholder="Buscar medicamentos por código, descripción o laboratorio...">
            </div>

            <!-- Productos Seleccionados -->
            <div class="selected-products" id="selectedProducts">
                <h3><i class="fas fa-shopping-cart"></i> Productos Seleccionados: <span id="selectedCount">0</span></h3>
                <div id="selectedList"></div>
            </div>

            <!-- Grid de Productos -->
            <div class="products-grid" id="productsGrid">
                <!-- Los productos se cargarán aquí -->
            </div>

            <!-- Botón de Cotización -->
            <button class="btn-quote" id="quoteBtn" onclick="generateQuote()" style="display: none;">
                <i class="fas fa-file-pdf"></i> Solicitar Cotización
            </button>
        </div>
    </div>

    <script>
        // Datos de medicamentos - AQUÍ DEBES CARGAR TU ARCHIVO DE 18,000+ PRODUCTOS
        // Puedes reemplazar este array con los datos de tu archivo CSV/JSON
        let medications = [
            {
                barcode: "7501234567890",
                description: "PARACETAMOL 500MG",
                formula: "Paracetamol 500mg",
                laboratory: "Farmaceuticos Unidos"
            },
            {
                barcode: "7501234567891",
                description: "IBUPROFENO 400MG",
                formula: "Ibuprofeno 400mg",
                laboratory: "Laboratorios Vida"
            },
            {
                barcode: "7501234567892",
                description: "AMOXICILINA 500MG",
                formula: "Amoxicilina 500mg",
                laboratory: "Antibióticos SA"
            },
            {
                barcode: "7501234567893",
                description: "OMEPRAZOL 20MG",
                formula: "Omeprazol 20mg",
                laboratory: "Gastro Med"
            },
            {
                barcode: "7501234567894",
                description: "METFORMINA 850MG",
                formula: "Metformina HCl 850mg",
                laboratory: "Diabetes Care"
            }
        ];

        // Función para cargar medicamentos desde archivo JSON
        async function loadMedicationsFromFile() {
            try {
                // Cargar desde archivo JSON
                const response = await fetch('medicamentos.json');
                if (response.ok) {
                    medications = await response.json();
                    console.log(`Cargados ${medications.length} medicamentos desde archivo JSON`);
                    loadProducts();
                } else {
                    console.log('No se pudo cargar medicamentos.json, usando datos de muestra');
                    loadProducts();
                }
            } catch (error) {
                console.log('Error al cargar archivo, usando datos de muestra:', error);
                loadProducts();
            }
        }

        // Función para parsear CSV (si usas CSV)
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',');
            const result = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',');
                    result.push({
                        barcode: values[0]?.trim() || '',
                        description: values[1]?.trim() || '',
                        formula: values[2]?.trim() || '',
                        laboratory: values[3]?.trim() || ''
                    });
                }
            }
            return result;
        }

        let selectedProducts = [];
        let currentUser = {};

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Intentar cargar medicamentos desde archivo JSON
            loadMedicationsFromFile();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Formulario de registro
            document.getElementById('registrationForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleRegistration();
            });

            // Búsqueda
            document.getElementById('searchInput').addEventListener('input', function(e) {
                filterProducts(e.target.value);
            });
        }

        function handleRegistration() {
            currentUser = {
                fullName: document.getElementById('fullName').value,
                phone: document.getElementById('phone').value,
                city: document.getElementById('city').value,
                email: document.getElementById('email').value
            };

            showCatalog();
        }

        function showCatalog() {
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('catalogSection').style.display = 'block';
        }

        function showWelcome() {
            document.getElementById('welcomeSection').style.display = 'block';
            document.getElementById('catalogSection').style.display = 'none';
        }

        function loadProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';

            medications.forEach((product, index) => {
                const productCard = createProductCard(product, index);
                grid.appendChild(productCard);
            });
        }

        function createProductCard(product, index) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <div class="product-header">
                    <div class="product-info">
                        <h3><i class="fas fa-prescription-bottle"></i> ${product.description}</h3>
                        <div class="product-details">
                            <p><strong><i class="fas fa-barcode"></i> Código:</strong> ${product.barcode}</p>
                            <p><strong><i class="fas fa-flask"></i> Fórmula:</strong> ${product.formula}</p>
                            <p><strong><i class="fas fa-building"></i> Laboratorio:</strong> ${product.laboratory}</p>
                        </div>
                    </div>
                </div>
                <div class="product-controls">
                    <input type="checkbox" class="checkbox" id="check-${index}" onchange="toggleProduct(${index})">
                    <label for="check-${index}">Seleccionar</label>
                    <input type="number" class="quantity-input" id="qty-${index}" min="1" value="1" onchange="updateQuantity(${index})" disabled>
                    <span>unidades</span>
                </div>
            `;
            return card;
        }

        function toggleProduct(index) {
            const checkbox = document.getElementById(`check-${index}`);
            const quantityInput = document.getElementById(`qty-${index}`);
            const card = checkbox.closest('.product-card');

            if (checkbox.checked) {
                quantityInput.disabled = false;
                card.classList.add('selected');
                addToSelected(index);
            } else {
                quantityInput.disabled = true;
                card.classList.remove('selected');
                removeFromSelected(index);
            }

            updateSelectedDisplay();
        }

        function updateQuantity(index) {
            const quantity = parseInt(document.getElementById(`qty-${index}`).value) || 1;
            const productIndex = selectedProducts.findIndex(p => p.index === index);
            if (productIndex !== -1) {
                selectedProducts[productIndex].quantity = quantity;
            }
            updateSelectedDisplay();
        }

        function addToSelected(index) {
            const quantity = parseInt(document.getElementById(`qty-${index}`).value) || 1;
            selectedProducts.push({
                index: index,
                product: medications[index],
                quantity: quantity
            });
        }

        function removeFromSelected(index) {
            selectedProducts = selectedProducts.filter(p => p.index !== index);
        }

        function updateSelectedDisplay() {
            const selectedContainer = document.getElementById('selectedProducts');
            const selectedList = document.getElementById('selectedList');
            const selectedCount = document.getElementById('selectedCount');
            const quoteBtn = document.getElementById('quoteBtn');

            selectedCount.textContent = selectedProducts.length;

            if (selectedProducts.length > 0) {
                selectedContainer.style.display = 'block';
                quoteBtn.style.display = 'flex';

                selectedList.innerHTML = selectedProducts.map(item => `
                    <div style="padding: 10px; border-bottom: 1px solid #ddd;">
                        <strong>${item.product.description}</strong> - ${item.quantity} unidades
                    </div>
                `).join('');
            } else {
                selectedContainer.style.display = 'none';
                quoteBtn.style.display = 'none';
            }
        }

        function filterProducts(searchTerm) {
            const cards = document.querySelectorAll('.product-card');
            const term = searchTerm.toLowerCase();

            cards.forEach((card, index) => {
                const product = medications[index];
                const matches = 
                    product.barcode.toLowerCase().includes(term) ||
                    product.description.toLowerCase().includes(term) ||
                    product.formula.toLowerCase().includes(term) ||
                    product.laboratory.toLowerCase().includes(term);

                card.style.display = matches ? 'block' : 'none';
            });
        }

        function generateQuote() {
            if (selectedProducts.length === 0) {
                alert('Por favor selecciona al menos un producto.');
                return;
            }

            // Generar PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Encabezado
            doc.setFontSize(20);
            doc.setTextColor(33, 150, 243);
            doc.text('COTIZACIÓN DE MEDICAMENTOS', 20, 30);

            // Información del cliente
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`Cliente: ${currentUser.fullName}`, 20, 50);
            doc.text(`Teléfono: ${currentUser.phone}`, 20, 60);
            doc.text(`Ciudad: ${currentUser.city}`, 20, 70);
            doc.text(`Email: ${currentUser.email}`, 20, 80);

            // Fecha
            const today = new Date();
            doc.text(`Fecha: ${today.toLocaleDateString('es-ES')}`, 20, 90);

            // Productos
            doc.setFontSize(14);
            doc.setTextColor(33, 150, 243);
            doc.text('PRODUCTOS SOLICITADOS:', 20, 110);

            let yPosition = 125;
            selectedProducts.forEach((item, index) => {
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`${index + 1}. ${item.product.description}`, 20, yPosition);
                doc.text(`   Código: ${item.product.barcode}`, 25, yPosition + 10);
                doc.text(`   Fórmula: ${item.product.formula}`, 25, yPosition + 20);
                doc.text(`   Laboratorio: ${item.product.laboratory}`, 25, yPosition + 30);
                doc.text(`   Cantidad: ${item.quantity} unidades`, 25, yPosition + 40);
                yPosition += 55;
            });

            // Pie de página
            doc.setFontSize(12);
            doc.setTextColor(0, 167, 167);
            doc.text('GlobalMediTH - Distribución Confiable, Salud Garantizada', 20, yPosition + 20);
            doc.text('Contacto: globalmedith@gmail.com', 20, yPosition + 30);

            // Guardar PDF
            const pdfBlob = doc.output('blob');
            const pdfUrl = URL.createObjectURL(pdfBlob);

            // Preparar mensaje para WhatsApp
            const message = `Hola! Soy ${currentUser.fullName} y me gustaría solicitar una cotización para los siguientes medicamentos:\n\n` +
                selectedProducts.map((item, index) => 
                    `${index + 1}. ${item.product.description} - ${item.quantity} unidades`
                ).join('\n') +
                `\n\nMis datos de contacto:\nTeléfono: ${currentUser.phone}\nCiudad: ${currentUser.city}\nEmail: ${currentUser.email}\n\nGracias!`;

            // Abrir WhatsApp
            const whatsappUrl = `https://wa.me/522381646718?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');

            // Abrir PDF en nueva ventana
            window.open(pdfUrl, '_blank');

            // Opcional: Enviar por email (esto requeriría un backend)
            // Por ahora solo mostramos un mensaje
            setTimeout(() => {
                alert('¡Cotización generada! Se ha abierto WhatsApp y el PDF con tu solicitud.');
            }, 1000);
        }
    </script>
</body>
</html>